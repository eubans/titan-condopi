!function(k){"use strict";function c(e,t){var s=this,i=e.attr("name")||t.name||"",l=e.parent().attr("style")||"";e.parent().hide();var o=e.css("width");e.parent().show().attr("style",l),"0px"==o&&(o=e.outerWidth()+20),this.$el=e.hide(),this.options=t,this.$parent=k("<div"+k.map(["class","title"],function(e){var t=s.$el.attr(e)||"";return(t=("class"===e?"ms-parent"+(t?" ":""):"")+t)?" "+e+'="'+t+'"':""}).join("")+" />"),this.$choice=k('<button type="button" class="ms-choice"><span class="placeholder">'+t.placeholder+"</span><div></div></button>"),this.$drop=k('<div class="ms-drop '+t.position+'"></div>'),this.$el.after(this.$parent),this.$parent.append(this.$choice),this.$parent.append(this.$drop),this.$el.prop("disabled")&&this.$choice.addClass("disabled"),this.$parent.css("width",t.width||o),this.options.keepOpen||k("body").click(function(e){k(e.target)[0]!==s.$choice[0]&&k(e.target).parents(".ms-choice")[0]!==s.$choice[0]&&(k(e.target)[0]!==s.$drop[0]&&k(e.target).parents(".ms-drop")[0]===s.$drop[0]||!s.options.isOpen||s.close())}),this.selectAllName='name="selectAll'+i+'"',this.selectGroupName='name="selectGroup'+i+'"',this.selectItemName='name="selectItem'+i+'"'}c.prototype={constructor:c,init:function(){var s=this;this.options.filter&&this.$drop.append('<div class="ms-search">','<input type="text" autocomplete="off" autocorrect="off" autocapitilize="off" spellcheck="false">',"</div>");var i=k("<ul></ul>");this.options.selectAll&&!this.options.single&&i.append('<li class="ms-select-all"><label><input type="checkbox" '+this.selectAllName+" /> "+this.options.selectAllDelimiter[0]+this.options.selectAllText+this.options.selectAllDelimiter[1]+"</label></li>"),k.each(this.$el.children(),function(e,t){i.append(s.optionToHtml(e,t))}),i.append('<li class="ms-no-results">'+this.options.noMatchesFound+"</li>"),this.$drop.append(i),this.$drop.find("ul").css("max-height",this.options.maxHeight+"px"),this.$drop.find(".multiple").css("width",this.options.multipleWidth+"px"),this.$searchInput=this.$drop.find(".ms-search input"),this.$selectAll=this.$drop.find("input["+this.selectAllName+"]"),this.$selectGroups=this.$drop.find("input["+this.selectGroupName+"]"),this.$selectItems=this.$drop.find("input["+this.selectItemName+"]:enabled"),this.$disableItems=this.$drop.find("input["+this.selectItemName+"]:disabled"),this.$noResults=this.$drop.find(".ms-no-results"),this.events(),this.updateSelectAll(!0),this.update(!0),this.options.isOpen&&this.open()},optionToHtml:function(e,t,s,i){var l,o=this,n=k(t),c=this.options.multiple,h=k.map(["class","title"],function(e,t){var s="class"===e&&c,i=n.attr(e)||"";return s||i?" "+e+'="'+(s?"multiple"+(i?" ":""):"")+i+'"':""}).join(""),p=this.options.single?"radio":"checkbox";if(n.is("option")){var a,r=n.val(),d=o.options.textTemplate(n),u=n.prop("selected"),f=this.options.styler(r)?' style="'+this.options.styler(r)+'"':"";return l=i||n.prop("disabled"),""<this.options.blockSeparator&&this.options.blockSeparator==n.val()?(a=k("<li"+h+f+">",'<label class="'+this.options.blockSeparator+(l?"disabled":"")+'">',"</label>","</li>")).find("label").append(document.createTextNode(d)):((a=k("<li"+h+f+"><label"+(l?' class="disabled"':"")+'><input type="'+p+'" '+this.selectItemName+(u?' checked="checked"':"")+(l?' disabled="disabled"':"")+(s?' data-group="'+s+'"':"")+"/> </label></li>")).find("input").val(r),a.find("label").append(document.createTextNode(d))),a}if(!s&&n.is("optgroup")){var m="group_"+e,$=n.attr("label");return l=n.prop("disabled"),(s=k("<div/>")).append('<li class="group"><label class="optgroup'+(l?" disabled":"")+'" data-group="'+m+'">'+(this.options.hideOptgroupCheckboxes?"":'<input type="checkbox" '+this.selectGroupName+(l?' disabled="disabled"':"")+" /> ")+$+"</label></li>"),a.find("label").append(document.createTextNode(d)),k.each(n.children(),function(e,t){s.append(o.optionToHtml(e,t,m,l))}),s.html()}},events:function(){var i=this;function t(e){e.preventDefault(),i[i.options.isOpen?"close":"open"]()}var e=this.$el.parent().closest("label")[0]||k("label[for="+this.$el.attr("id").split(":").join("\\:")+"]")[0];e&&k(e).off("click").on("click",function(e){"label"===e.target.nodeName.toLowerCase()&&e.target===this&&(t(e),i.options.filter&&i.options.isOpen||i.focus(),e.stopPropagation())}),this.$choice.off("click").on("click",t).off("focus").on("focus",this.options.onFocus).off("blur").on("blur",this.options.onBlur),this.$parent.off("keydown").on("keydown",function(e){switch(e.which){case 27:i.close(),i.$choice.focus()}}),this.$searchInput.off("keydown").on("keydown",function(e){9===e.keyCode&&e.shiftKey&&i.close()}).off("keyup").on("keyup",function(e){if(i.options.filterAcceptOnEnter&&(13===e.which||32==e.which)&&i.$searchInput.val())return i.$selectAll.click(),i.close(),void i.focus();i.filter()}),this.$selectAll.off("click").on("click",function(){var e=k(this).prop("checked"),t=i.$selectItems.filter(":visible");t.length===i.$selectItems.length?i[e?"checkAll":"uncheckAll"]():(i.$selectGroups.prop("checked",e),t.prop("checked",e),i.options[e?"onCheckAll":"onUncheckAll"](),i.update())}),this.$selectGroups.off("click").on("click",function(){var e=k(this).parent().attr("data-group"),t=i.$selectItems.filter(":visible").filter('[data-group="'+e+'"]'),s=t.length!==t.filter(":checked").length;t.prop("checked",s),i.updateSelectAll(),i.update(),i.options.onOptgroupClick({label:k(this).parent().text(),checked:s,children:t.get()})}),this.$selectItems.off("click").on("click",function(){i.updateSelectAll(),i.update(),i.updateOptGroupSelect(),i.options.onClick({label:k(this).parent().text(),value:k(this).val(),checked:k(this).prop("checked")}),i.options.single&&i.options.isOpen&&!i.options.keepOpen&&i.close()})},open:function(){if(!this.$choice.hasClass("disabled")){if(this.options.isOpen=!0,this.$choice.find(">div").addClass("open"),this.$drop.show(),this.$selectAll.parent().show(),this.$noResults.hide(),0===this.$el.children().length&&(this.$selectAll.parent().hide(),this.$noResults.show()),this.options.container){var e=this.$drop.offset();this.$drop.appendTo(k(this.options.container)),this.$drop.offset({top:e.top,left:e.left})}this.options.filter&&(this.$searchInput.val(""),this.$searchInput.focus(),this.filter()),this.options.onOpen()}},close:function(){this.options.isOpen=!1,this.$choice.find(">div").removeClass("open"),this.$drop.hide(),this.options.container&&(this.$parent.append(this.$drop),this.$drop.css({top:"auto",left:"auto"})),this.options.onClose()},update:function(e){var t=this.getSelects(),s=this.$choice.find(">span");0===t.length?s.addClass("placeholder").html(this.options.placeholder):this.options.countSelected&&t.length<this.options.minimumCountSelected?s.removeClass("placeholder").text((this.options.displayValues?t:this.getSelects("text")).join(this.options.delimiter)):this.options.allSelected&&t.length===this.$selectItems.length+this.$disableItems.length?s.removeClass("placeholder").html(this.options.allSelected):(this.options.countSelected||this.options.etcaetera)&&t.length>this.options.minimumCountSelected?this.options.etcaetera?s.removeClass("placeholder").text((this.options.displayValues?t:this.getSelects("text").slice(0,this.options.minimumCountSelected)).join(this.options.delimiter)+"..."):s.removeClass("placeholder").html(this.options.countSelected.replace("#",t.length).replace("%",this.$selectItems.length+this.$disableItems.length)):s.removeClass("placeholder").text((this.options.displayValues?t:this.getSelects("text")).join(this.options.delimiter)),this.options.addTitle&&s.prop("title",this.getSelects("text")),this.$el.val(this.getSelects()),this.$drop.find("li").removeClass("selected"),this.$drop.find("input["+this.selectItemName+"]:checked").each(function(){k(this).parents("li").first().addClass("selected")}),e||this.$el.trigger("change")},updateSelectAll:function(e){var t=this.$selectItems;e||(t=t.filter(":visible")),this.$selectAll.prop("checked",t.length&&t.length===t.filter(":checked").length),this.$selectAll.prop("checked")&&this.options.onCheckAll()},updateOptGroupSelect:function(){var l=this.$selectItems.filter(":visible");k.each(this.$selectGroups,function(e,t){var s=k(t).parent().attr("data-group"),i=l.filter('[data-group="'+s+'"]');k(t).prop("checked",i.length&&i.length===i.filter(":checked").length)})},getSelects:function(e){var n=this,c=[],t=[];return this.$drop.find("input["+this.selectItemName+"]:checked").each(function(){c.push(k(this).parents("li").first().text()),t.push(k(this).val())}),"text"===e&&this.$selectGroups.length&&(c=[],this.$selectGroups.each(function(){var e=[],t=k.trim(k(this).parent().text()),s=k(this).parent().data("group"),i=n.$drop.find("["+n.selectItemName+'][data-group="'+s+'"]'),l=i.filter(":checked");if(0!==l.length){if(e.push("["),e.push(t),i.length>l.length){var o=[];l.each(function(){o.push(k(this).parent().text())}),e.push(": "+o.join(", "))}e.push("]"),c.push(e.join(""))}})),"text"===e?c:t},setSelects:function(e){var s=this;this.$selectItems.prop("checked",!1),k.each(e,function(e,t){s.$selectItems.filter('[value="'+t+'"]').prop("checked",!0)}),this.$selectAll.prop("checked",this.$selectItems.length===this.$selectItems.filter(":checked").length),this.update()},enable:function(){this.$choice.removeClass("disabled")},disable:function(){this.$choice.addClass("disabled")},checkAll:function(){this.$selectItems.prop("checked",!0),this.$selectGroups.prop("checked",!0),this.$selectAll.prop("checked",!0),this.update(),this.options.onCheckAll()},uncheckAll:function(){this.$selectItems.prop("checked",!1),this.$selectGroups.prop("checked",!1),this.$selectAll.prop("checked",!1),this.update(),this.options.onUncheckAll()},focus:function(){this.$choice.focus(),this.options.onFocus()},blur:function(){this.$choice.blur(),this.options.onBlur()},refresh:function(){this.init()},filter:function(){var s=this,t=k.trim(this.$searchInput.val()).toLowerCase();0===t.length?(this.$selectItems.parent().show(),this.$disableItems.parent().show(),this.$selectGroups.parent().show()):(this.$selectItems.each(function(){var e=k(this).parent();e[e.text().toLowerCase().indexOf(t)<0?"hide":"show"]()}),this.$disableItems.parent().hide(),this.$selectGroups.each(function(){var e=k(this).parent(),t=e.attr("data-group");e[0===s.$selectItems.filter(":visible").filter('[data-group="'+t+'"]').length?"hide":"show"]()}),this.$selectItems.filter(":visible").length?(this.$selectAll.parent().show(),this.$noResults.hide()):(this.$selectAll.parent().hide(),this.$noResults.show())),this.updateOptGroupSelect(),this.updateSelectAll()}},k.fn.multipleSelect=function(){var i,l=arguments[0],o=arguments,n=["getSelects","setSelects","enable","disable","checkAll","uncheckAll","focus","blur","refresh","close"];return this.each(function(){var e=k(this),t=e.data("multipleSelect"),s=k.extend({},k.fn.multipleSelect.defaults,e.data(),"object"==typeof l&&l);if(t||(t=new c(e,s),e.data("multipleSelect",t)),"string"==typeof l){if(k.inArray(l,n)<0)throw"Unknown method: "+l;i=t[l](o[1])}else t.init(),o[1]&&(i=t[o[1]].apply(t,[].slice.call(o,2)))}),i||this},k.fn.multipleSelect.defaults={name:"",isOpen:!1,placeholder:"",selectAll:!0,selectAllText:"Select all",selectAllDelimiter:["[","]"],allSelected:"All selected",minimumCountSelected:3,countSelected:"# of % selected",noMatchesFound:"No matches found",multiple:!1,multipleWidth:80,single:!1,filter:!1,width:void 0,maxHeight:250,container:null,position:"bottom",keepOpen:!1,blockSeparator:"",displayValues:!1,delimiter:", ",addTitle:!1,styler:function(){return!1},textTemplate:function(e){return e.text()},onOpen:function(){return!1},onClose:function(){return!1},onCheckAll:function(){return!1},onUncheckAll:function(){return!1},onFocus:function(){return!1},onBlur:function(){return!1},onOptgroupClick:function(){return!1},onClick:function(){return!1}}}(jQuery);